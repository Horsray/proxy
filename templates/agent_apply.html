{% extends 'layout.html' %}
{% block title %}批量开通申请{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <h2 class="mb-1" style="color: var(--gray-800); font-weight: 700;">
      <i class="fas fa-paper-plane me-3" style="color: var(--primary-color);"></i>批量开通申请
    </h2>
  </div>
</div>
<div class="card mb-4">
  <div class="card-header">
    <i class="fas fa-plus-circle me-2"></i>提交申请
  </div>
  <div class="card-body">
    <form class="row g-3" method="post" action="{{ url_for('agent_apply') }}">
      <div class="col-md-2">
        <label class="form-label">数量</label>
        <input type="number" name="count" class="form-control" value="1" min="1" required>
      </div>
      <div class="col-md-2">
        <label class="form-label">单价</label>
        <input type="number" name="price" step="0.01" class="form-control" required>
      </div>
      <div class="col-md-4">
        <label class="form-label">产品</label>
        <select name="product" class="form-select" required>
          <option value="">请选择产品</option>
          {% for p in products.values() %}
          <option value="{{ p.name }}" data-price="{{ p.price }}" {% if p.default %}selected{% endif %}>{{ p.name }} {{ p.version }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-4 d-flex align-items-end">
        <button class="btn btn-primary" type="submit"><i class="fas fa-paper-plane me-2"></i>提交</button>
      </div>
    </form>
  </div>
</div>
{% if apps %}
<div class="card">
  <div class="card-header">申请记录</div>
  <div class="card-body p-0">
    <div class="table-responsive">
      <table class="table table-hover mb-0">
        <thead>
          <tr>
            <th>时间</th>
            <th>产品</th>
            <th>数量</th>
            <th>单价</th>
            <th>状态</th>
          </tr>
        </thead>
        <tbody>
          {% for a in apps %}
          <tr>
            <td>{{ a.created_at }}</td>
            <td>{{ a.product }}</td>
            <td>{{ a.count }}</td>
            <td>{{ a.price }}</td>
            <td>
              {% if a.status == 'pending' %}
                <span class="badge bg-warning">待审批</span>
              {% elif a.status == 'approved' %}
                <span class="badge bg-success">已通过</span>
              {% else %}
                <span class="badge bg-danger">已拒绝</span>
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endif %}
{% endblock %}
